<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <title>Hello, AR Cube!</title>
    <!-- include three.js library -->
    <script src="js/three.js"></script>
    <!-- include jsartookit -->
    <script src="jsartoolkit5/artoolkit.min.js"></script>
    <script src="jsartoolkit5/artoolkit.api.js"></script>
    <!-- include threex.artoolkit -->
    <script src="threex/threex-artoolkitsource.js"></script>
    <script src="threex/threex-artoolkitcontext.js"></script>
    <script src="threex/threex-arbasecontrols.js"></script>
    <script src="threex/threex-armarkercontrols.js"></script>
  </head>

  <body style="margin: 0px; overflow: hidden; font-family: Monospace">
    <div id="window3d" style="display: block">window</div>
    <div id="ARThreeJS"></div>

    <script>
      let scene, camera, renderer, cube;

      init();
      animate();

      document.querySelector('#ARThreeJS').appendChild(renderer.domElement);

      function init() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        const geometry = new THREE.BoxGeometry(1, 1, 1);
        const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
        cube = new THREE.Mesh(geometry, material);
        scene.add(cube);
        camera.position.z = 5;
      }

      function animate() {
        requestAnimationFrame(animate);

        cube.rotation.x += 0.01;
        cube.rotation.y += 0.01;

        renderer.render(scene, camera);
      }

      function handleOrientation(event) {
        alpha = event.alpha; // угол поворота устройства по оси Z
        beta = event.beta; // угол наклона устройства по оси X
        gamma = event.gamma; // угол наклона устройства по оси Y
        document.getElementById('window3d').textContent = `${alpha},${beta},${gamma}`;
      }

      function permission() {
        if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
          DeviceMotionEvent.requestPermission()
            .then((response) => {
              if (response == 'granted') {
                window.addEventListener('devicemotion', (e) => {
                  handleOrientation(e);
                });
              }
            })
            .catch(console.error);
        } else {
          alert('DeviceMotionEvent is not defined');
        }
      }

      permission();
    </script>
  </body>
</html>
